"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _stringify=require("babel-runtime/core-js/json/stringify"),_stringify2=_interopRequireDefault(_stringify),_promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Browser=require("orion-core/lib/model/browser/Local"),SelfSpawner=require("orion-core/lib/process/SelfSpawner"),xfs=require("orion-core/lib/xfs"),console=require("orion-core/lib/util/console-manager").console,allowedMessages={ipcReady:1,sandboxCreated:1,sandboxReady:1,sandboxClosed:1,sandboxTerminated:1,log:1},SandboxBrowser=function(a){function b(a){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).call(this,(0,_assign2["default"])({description:"Sandbox",version:process.version.chrome,profile:"",type:"chromium",detected:!0},a)))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"devToolsPort",get:function(){var a=this;return a._devToolsPort||(a._devToolsPort=a.portSeed++)}}],[{key:"meta",get:function(){return{mixins:[SelfSpawner],prototype:{isSandbox:!0,isDebuggable:!0,portSeed:9222}}}}]),(0,_createClass3["default"])(b,[{key:"launch",value:function(){var a=this;return new _promise2["default"](function(b,c){a.mixins.selfSpawner.spawn.call(a),a._resolveLaunch=b})}},{key:"getSpawnSwitches",value:function(){return["--sandbox","--remote-debugging-port="+this.devToolsPort]}},{key:"getChildProcessDescription",value:function(){return"Sencha Test Sandbox"}},{key:"onTaskRunning",value:function(){var a=this,b=a.task.proc;b.on("message",function(b){var c=b.type||b;allowedMessages[c]&&(a.fire(c,b),a[c]&&a[c](b))})}},{key:"log",value:function(a){console.log("sandbox main process log: "+(0,_stringify2["default"])(a))}},{key:"ipcReady",value:function(){var a=this,b=a.task.proc;b.send({type:"run",url:a.get("url"),devtoolsPort:a.devToolsPort,proxyPort:a.get("proxyPort")}),a._resolveLaunch(a.task)}},{key:"onTaskComplete",value:function(){}},{key:"screenshot",value:function(a){var b=this;return new _promise2["default"](function(a,c){b._screenshotResolve=a,b.task.proc.send({type:"screenshot"})})}},{key:"terminate",value:function(){var a=this;a.task.proc.send({type:"terminate"})}},{key:"getDriverConfig",value:function(){var a=this.get("browser"),b=a.data,c=a.pool.farm;return c.driverConfig(b)}}]),b}(Browser);module.exports=SandboxBrowser;