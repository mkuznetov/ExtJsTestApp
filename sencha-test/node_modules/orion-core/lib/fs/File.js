"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Observable=require("../Observable"),fs=require("fs"),Path=require("path"),Operations=require("./Operations"),SyncOperations=require("./SyncOperations"),WindowsFileOperations=require("orion-core/lib/fs/WindowsFileOperations"),Util=require("../Util"),slashRe=/\\/g,splitRe=/[\/\\]/g,File=function(a){function b(a,c){(0,_classCallCheck3["default"])(this,b);var d=(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).call(this));return c?(a.$isFile&&(a=a.getPath()),c=b.join(a,c)):a&&(a.$isFile?c=a.getPath():"string"==typeof a&&(c=a)),d.path=c,d}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,null,[{key:"get",value:function(a){return a?a.$isFile?a:new b(a):null}},{key:"meta",get:function(){var a={prototype:{$isFile:!0},mixins:[WindowsFileOperations,Operations,SyncOperations]};return Util.isWin||a.mixins.shift(),a}}]),(0,_createClass3["default"])(b,[{key:"lastIndexOfSep",value:function(){var a=this.path;return Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"))}},{key:"getPath",value:function(){return this.path}},{key:"getCanonicalFile",value:function(){return new b(this.getCanonicalPath())}},{key:"getCanonicalPath",value:function(){return Path.resolve(this.getPath())}},{key:"isAbsolute",value:function(){return Path.isAbsolute(this.getPath())}},{key:"normalizePath",value:function(){var a=this.separator;return this.getPath().replace(slashRe,a).replace(slashRe,a)}},{key:"relativeTo",value:function(a){return a.$isFile&&(a=a.getCanonicalPath()),new b(Path.relative(this.getCanonicalPath(),a))}},{key:"equals",value:function(a){return a=b.get(a),null!==a&&(Util.isLinux?a.trimSlash()==this.trimSlash():a.trimSlash().toLowerCase()==this.trimSlash().toLowerCase())}},{key:"contains",value:function(a){if(a=b.get(a),null===a)return!1;var c=this.slashify(),d=a.slashify();return!(!d.startsWith(c)||!c.endsWith("/")&&"/"!==d.charAt(c.length))}},{key:"slashify",value:function(){return this.getPath().replace(slashRe,"/")}},{key:"trimSlash",value:function(){var a=this.getPath();return void 0===a?"":a.endsWith("/")||a.endsWith("\\")?a.substring(0,a.length-1):a}},{key:"getPathParts",value:function(){return b.split(this.getPath())}},{key:"getParent",value:function(){var a=this.parent;return a?a.getPath():null}},{key:"getParentFile",value:function(){return this.parent}},{key:"getTempFile",value:function(a){var c,d=new Date,e="",f=0;for(d=[d.getFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getHours(),d.getMinutes(),d.getSeconds()].join(".");;){if(c=new b(this,d+e),!c.existsSync())return c;f++,e="."+f}}},{key:"join",value:function(a){return a=a.$isFile?a.path:a,new b(this,a)}},{key:"toString",value:function(){return this.path}},{key:"name",get:function(){var a,b=this,c=b._name;return void 0===c&&(a=b.lastIndexOfSep(),c=a<0?null:b.path.substring(a+1),b._name=c),c}},{key:"parent",get:function(){var a,c,d=this,e=d._parent;return void 0===e&&(a=d.lastIndexOfSep(),c=d.path.substring(0,a),e=a<0||!c?null:new b(c),d._parent=e),e}},{key:"canonicalPath",get:function(){return this.getCanonicalPath()}}],[{key:"sanitizePath",value:function(a){return a.trim().replace(/\s+/g,"_").replace(/[^0-9a-zA-Z_-]/g,"").substr(0,60)}},{key:"slashify",value:function(a){return a&&a.replace(slashRe,"/")}},{key:"join",value:function(){var a,b,c,d=Util.flatten(arguments),e=d.length,f=this.sepRe.test(d[0].charAt(0))||""===d[0];for(a=0;a<e;a++)b=d[a],"string"==typeof b&&(d[a]=b.split(splitRe));return c=Util.flatten(d).filter(function(a){return!!a}).join(this.separator),f&&(c=this.separator+c),c}},{key:"setSeparator",value:function(a){this.separator=a}},{key:"getSeparator",value:function(){return this.separator}},{key:"split",value:function(a){return(a||"").split(splitRe)}},{key:"flatten",value:function(){return b._flatten(Util.flatten(Array.prototype.slice.call(arguments)))}},{key:"_flatten",value:function(a){var c,d,e=this.separator,f=a.join(e),g=b.split(f),h=[];for(d=0;d<g.length;d++)if(c=g[d],".."===c&&h.length){var i=h.pop();".."===i&&(h.push(i),h.push(c))}else{if("."===c)continue;h.push(c)}return h.join(e)}},{key:"fileStatSorter",value:function(a,b){var c=a.stat,d=b.stat;if(c.isDirectory()){if(d.isFile())return-1}else if(d.isDirectory())return 1;return a.name.localeCompare(b.name)}}]),b}(Observable);File.separator=File.prototype.separator=Util.isWin?"\\":"/",File.sepRe=File.prototype.sepRe=/[\/\\]/,module.exports=File;