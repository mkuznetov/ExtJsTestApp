"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Base=require("../Base"),Image=require("./Image"),Comparator=function(a){function b(a){(0,_classCallCheck3["default"])(this,b);var c=(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).call(this)),d=c;return(0,_assign2["default"])(d,{errorColor:{red:255,green:0,blue:255},transparency:.3,mask:255}),(0,_assign2["default"])(d,a),c}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"compare",value:function(a,b){a=a.isImage?a:new Image(a),b=b.isImage?b:new Image(b);var c=this;return new _promise2["default"](function(d,e){var f=null,g=null,h=!1,i=!1,j=function(){if(f&&g)try{var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=Math.max(a.width,b.width),N=Math.max(a.height,b.height),O=new Image({width:M,height:N}),P=O.data,Q=0,R=c.errorColor.red,S=c.errorColor.green,T=c.errorColor.blue,U=c.transparency,V=c.mask;for(j=0;j<N;j++)for(k=0;k<M;k++)l=j*a.width+k,m=j*b.width+k,n=j*M+k,q=4*n,A=q+0,B=q+1,C=q+2,D=q+3,k<a.width&&k<b.width&&j<a.height&&j<b.height?(o=4*l,s=o+0,t=o+1,u=o+2,v=o+3,p=4*m,w=p+0,x=p+1,y=p+2,z=p+3,E=g[s],G=g[t],F=g[u],H=g[v],I=E-f[w],K=G-f[x],J=F-f[y],L=H-f[z],P[A]=E,P[B]=G,P[C]=F,P[D]=H*U):I=K=J=L=255,r=I|K|J|L,r&&(I=I<0?-I:I,K=K<0?-K:K,J=J<0?-J:J,L=L<0?-L:L,r=I&V|K&V|J&V|L&V,r&&(Q++,P[A]=R,P[B]=S,P[C]=T,P[D]=255));O.diffCount=Q,d(O)}catch(W){e(W)}else h&&i&&e("Failed to load files")};a.load().then(function(){g=a.data,h=!0,j()})["catch"](function(a){e(a)}),b.load().then(function(){f=b.data,i=!0,j()})["catch"](function(a){e(a)})})}}]),b}(Base);module.exports=Comparator;