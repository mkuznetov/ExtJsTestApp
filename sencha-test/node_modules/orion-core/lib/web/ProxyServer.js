"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),httpProxy=require("http-proxy"),http=require("http"),RootProxyResponder=require("./RootProxyResponder"),RootFileSystemResponder=require("./RootFileSystemResponder"),Server=require("./Server"),ProxyServer=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"getProxy",value:function(){var a=this;return a.proxy||(a.proxy=httpProxy.createProxyServer({secure:!1,changeOrigin:!0}),a.proxy.on("proxyReq",a._onProxyReq.bind(a)),a.proxy.on("error",a._onProxyError.bind(a))),a.proxy}},{key:"getRootResponder",value:function(){var a=this,b=a._root;return b||(b=a.noProxy?new RootFileSystemResponder(a):new RootProxyResponder(a),a._root=b),b}},{key:"_onProxyReq",value:function(a,b,c,d){var e=b.headers.cookie;a.setHeader("Accept-Encoding","deflate"),e&&(b.headers.cookie=e&&e.replace(/GZ=Z=1;?\s?/,""))}},{key:"_onProxyError",value:function(a,b,c){var d=this;"ECONNRESET"!==a.code?(d.error((a.stack||a).toString()),d.fire({type:"proxyerror",error:a})):!b.complete}}],[{key:"meta",get:function(){return{prototype:{description:"Proxy Server"}}}}]),b}(Server);module.exports=ProxyServer;