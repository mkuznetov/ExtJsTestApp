"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Base=require("orion-core/lib/Base"),allowedMessages={run:1,screenshot:1},EmbeddedBrowserProcess=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"ctor",value:function(){var a=this;process.on("message",function(b){var c=b.type;process.send("Received "+c),allowedMessages[c]?a[c](b):console.error("Invalid message received: "+c)});var b=setInterval(function(){a._terminated&&clearInterval(b)},1e3)}},{key:"send",value:function(a){process.send?process.send(a):console.log(a)}},{key:"terminate",value:function(){this._terminated=!0}},{key:"run",value:function(a){var b=require("electron"),c=b.app,d=b.BrowserWindow,e=(process.argv,this),f=null,g=a.url,h=(a.show,a.width||1024),i=a.height||768;a.proxyPort;c.on("window-all-closed",function(){"darwin"!=process.platform&&c.quit()});var j=function(){f=new d({title:"Sencha Test - Chromium",width:h,height:i}),f.openDevTools(),f.loadURL(g),e.send("windowLoaded"),f.on("closed",function(){e.send("windowClosed"),f=null,process.exit(0)})};c.isReady()?j():c.on("ready",j)}}]),b}(Base);module.exports=EmbeddedBrowserProcess;