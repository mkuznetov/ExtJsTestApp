"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Base=require("orion-core/lib/Base"),Zip=require("orion-core/lib/fs/Zip"),xfs=require("orion-core/lib/xfs"),co=require("co"),fs=require("fs"),rp=require("request-promise"),url=require("url"),util=require("util"),path=require("path"),Client=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"upload",value:function(a,b){var c=this,d={method:"POST",uri:url.resolve(c.server,"/upload"),formData:{storageKey:b.storageKey||c.storageKey,archivePath:b.archivePath||"",archive:fs.createReadStream(a),overwrite:b.overwrite?"true":"false"},resolveWithFullResponse:!0},e=rp(d).then(function(a){return util.format("Server response: %s - %s",a.statusCode,a.body||a.statusMessage)})["catch"](function(a){var b=a.response;return util.format("Server response: %s - %s",b.statusCode,b.body||b.statusMessage)});return e}},{key:"download",value:function(a){var b=this,c=path.normalize(a.localPath),d=path.dirname(c),e={method:"POST",uri:url.resolve(b.server,"/download"),body:{root:a.root,storageKey:a.storageKey||b.storageKey,path:a.path},json:!0,encoding:null,resolveWithFullResponse:!0,simple:!1},f=xfs.mkdir(d).then(function(a){return rp(e)}).then(function(a){return 200===a.statusCode?xfs.writeFile(c+".zip",a.body):404===a.statusCode?_promise2["default"].resolve():(console.error(a),_promise2["default"].reject(a))}).then(function(a){if(a&&a.$isFile)return Zip.extract(c+".zip",path.dirname(c))});return f}}]),b}(Base);module.exports=Client;