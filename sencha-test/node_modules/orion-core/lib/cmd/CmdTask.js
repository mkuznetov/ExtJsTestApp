"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_get2=require("babel-runtime/helpers/get"),_get3=_interopRequireDefault(_get2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Task=require("../tasks/Task"),states={notrunning:{running:!1,error:!1},running:{running:!0,error:!1},interrupted:{running:!1,error:!1},complete:{running:!1,error:!1},exception:{running:!1,error:!0}},CmdTask=function(a){function b(a){(0,_classCallCheck3["default"])(this,b);var c=(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).call(this,a)),d=c;return d.lastLogLength=0,d.state="NotRunning",d.description=d.description||d.id,d.app=d.app||null,d.record=d.record||null,d.running=d.running||null,c}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"setState",value:function(a){var b=this,c=b.state,d=states[a.toLowerCase()],e=d.running;if(b._set("state",a),b._set("running",e),a!=c){var f=states[c.toLowerCase()];d&&f&&(e?b.fire("running"):b.done())}}},{key:"setCurrentTarget",value:function(a){this._set("currentAntTarget",a)}},{key:"update",value:function(a){var b=this;if(b.status=a,a.logs&&a.logs.length){for(var c=a.logs,d=b.lastLogLength;d<c.length;d++){var e=c[d];b.onLogMessage(e)}b.lastLogLength=c.length}a.description&&b.setDescription(a.description),b.setState(a.state)}},{key:"onLogMessage",value:function(a){var b=this;a.taskId=b.id,a.description=b.description,b.fire({type:"logMessage",message:a})}},{key:"onAntEvent",value:function(a){var b=this;a.description=b.description,this.fire({type:"antEvent",message:a})}},{key:"stop",value:function(){this.cmdClient&&this.cmdClient.stopTask(this).then(function(){})}},{key:"getRecordData",value:function(){var a=this,c=(0,_get3["default"])(b.prototype.__proto__||(0,_getPrototypeOf2["default"])(b.prototype),"getRecordData",this).call(this);return(0,_assign2["default"])(c,{state:a.state})}}]),b}(Task);module.exports=CmdTask;