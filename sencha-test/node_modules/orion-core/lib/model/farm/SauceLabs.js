"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_get2=require("babel-runtime/helpers/get"),_get3=_interopRequireDefault(_get2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),sauceConnectLauncher=require("sauce-connect-launcher"),util=require("util"),SauceLabsClient=require("saucelabs"),SauceLabsBrowser=require("orion-core/lib/model/browser/SauceLabs"),ChildProcessTask=require("orion-core/lib/tasks/ChildProcessTask"),Farm=require("./Farm"),SauceLabs=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"ctor",value:function(){var a=this.data;a.host=a.host||"ondemand.saucelabs.com",a.port=a.port||80}},{key:"driverConfig",value:function(a){var c=(0,_get3["default"])(b.prototype.__proto__||(0,_getPrototypeOf2["default"])(b.prototype),"driverConfig",this).call(this,a);return c.user=this.username,c.key=this.accessKey,c}},{key:"_start",value:function(){var a=this;return new _promise2["default"](function(b,c){var d=a._task;d||(d=a._task=new ChildProcessTask({description:"SauceLabs Connect Tunnel",launchProcess:function(){return new _promise2["default"](function(b,c){process.nextTick(function(){sauceConnectLauncher({username:a.get("username"),accessKey:a.get("accessKey"),verbose:!0,logger:function(a){d.onStdoutData(a)}},function(d,e){d?c(d):(a._tunnel=e,b(e))})})})}}),a.onTaskStart(d),d.on({scope:a,complete:function(){a.onTaskStop(),a._task=null,a._tunnel=null}})),d.running?b(d):d.on({scope:a,single:!0,running:function(){b(d)}})})}},{key:"stop",value:function(){var a=this._task;a&&a.stop()}},{key:"getBrowsers",value:function(){var a=this;return new _promise2["default"](function(b,c){a._getAccount().getAllBrowsers(function(a,d){if(a)c(a);else{var e=d.map(function(a){return new SauceLabsBrowser({browserName:a.api_name,version:a.short_version,platform:a.os})});b(e)}})})}},{key:"_getAccount",value:function(){return this._account||(this._account=new SauceLabsClient(this.username,this.accessKey))}},{key:"connectionDisplay",get:function(){return"SauceLabs Tunnel"}},{key:"displayInfo",get:function(){return{displayName:"Sauce Labs",iconClass:"saucelabs",trialURL:"https://saucelabs.com/signup/trial"}}},{key:"browserClass",get:function(){return SauceLabsBrowser}}]),b}(Farm);module.exports=SauceLabs;