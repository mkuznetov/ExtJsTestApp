"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _stringify=require("babel-runtime/core-js/json/stringify"),_stringify2=_interopRequireDefault(_stringify),_regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),fs=require("mz/fs"),path=require("path"),sanitize=require("sanitize-filename"),JsonReporter=function(){function a(b){(0,_classCallCheck3["default"])(this,a),this.groups=[],this.dir=b}return(0,_createClass3["default"])(a,[{key:"newGroup",value:function(a,b,c){var d=new OutputGroup(this,a,b,c);return this.groups.push(d),d}},{key:"flush",value:_regenerator2["default"].mark(function b(){var a,c;return _regenerator2["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return a=[],c=this,c.groups.forEach(function(b){a.push(_regenerator2["default"].mark(function c(){return _regenerator2["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,b.flush();case 2:case"end":return a.stop()}},c,this)}))}),b.next=5,a;case 5:c.groups=[];case 6:case"end":return b.stop()}},b,this)})}]),a}(),OutputGroup=function(){function a(b,c,d,e){(0,_classCallCheck3["default"])(this,a),c=c||"any",d=d||"any",e=e||"any",this.reporter=b,this.os=c,this.name=d,this.version=e,this.result={name:c+"@"+d+"@"+e,status:"passed",children:[]}}return(0,_createClass3["default"])(a,[{key:"newOutput",value:function(){return new ReportOutput(this)}},{key:"flush",value:_regenerator2["default"].mark(function b(){var a;return _regenerator2["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return a=path.join(this.reporter.dir,this.fileName),b.next=3,fs.writeFile(a,(0,_stringify2["default"])(this.result,null,4));case 3:case"end":return b.stop()}},b,this)})},{key:"fileName",get:function(){return sanitize(this.os+"-"+this.name+"-"+this.version+".json")}}]),a}(),ReportOutput=function(){function a(b){(0,_classCallCheck3["default"])(this,a),this.group=b,this.results=[],this.breadcrumb=[],this.passed=!0}return(0,_createClass3["default"])(a,[{key:"flush",value:function(){this.group.reporter.flush()}},{key:"reportMessage",value:function(a){var b=a.type,c=a.name,d=a.error,e=a.details;"testRunStarted"==b||("testRunFinished"==b?this.testRunFinished():"testSuiteStarted"==b?this.testSuiteStarted(c):"testSuiteFinished"==b?this.testSuiteFinished(c):"testStarted"==b?this.testStarted(c):"testFinished"==b?this.testFinished(c):"testFailed"==b&&this.testFailed(c,d,e))}},{key:"testRunFinished",value:function(){var a=this.group.result;this.passed||(a.status="failed"),a.children=a.children.concat(this.results)}},{key:"testSuiteStarted",value:function(a){var b=this.breadcrumb,c=b[b.length-1],d={name:a,status:"passed",children:[]};c&&c.children.push(d),b.length||this.results.push(d),b.push(d)}},{key:"testSuiteFinished",value:function(a){this.breadcrumb.pop()}},{key:"testStarted",value:function(a){var b=this.breadcrumb,c=b[b.length-1],d={name:a,status:"passed"};c&&c.children.push(d),b.push(d)}},{key:"testFinished",value:function(a){this.breadcrumb.pop()}},{key:"testFailed",value:function(a,b,c){var d=this.breadcrumb,e=d[d.length-1];e.message=b,e.details=c,d.forEach(function(a){a.status="failed"}),this.passed=!1}}]),a}();module.exports=JsonReporter;