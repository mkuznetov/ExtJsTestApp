"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_get2=require("babel-runtime/helpers/get"),_get3=_interopRequireDefault(_get2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),RecorderFocusManager=require("./RecorderFocusManager"),SandboxProcess=require("./SandboxProcess"),Util=require("orion-core/lib/Util"),path=require("path"),mainWindow=null,showSandboxIcon=!1,showSandboxDevTools=!1,ElectronSandboxProcess=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"run",value:function(a){var b=this,c=a.devtoolsPort,d=(a.proxyPort,a.url),e=path.normalize(__dirname+"/../../sandbox/preload.js"),f=require("electron"),g=f.BrowserWindow,h=b._app=f.app;showSandboxIcon||(h.setBadgeCount(0),h.setBadge&&h.setBadge(""),h.dock&&h.dock.hide()),h.commandLine.appendSwitch("disable-http-cache"),c&&h.commandLine.appendSwitch("remote-debugging-port",c.toString()),h.on("window-all-closed",function(){"darwin"!=process.platform&&h.quit()});var i=function(){if(mainWindow=new g({title:"Sencha Test Sandbox",webPreferences:{preload:e},skipTaskbar:!0,frame:!1,transparent:!0,toolbar:!1,resizable:!1,show:!1,width:0,height:0}),showSandboxDevTools&&mainWindow.openDevTools(),b.send("sandboxCreated"),mainWindow.loadURL(d),mainWindow.webContents.on("dom-ready",function(){b.send("sandboxReady")}),mainWindow.on("closed",function(){b.send("sandboxClosed"),mainWindow=null,process.exit(0)}),mainWindow.on("focus",function(){b.log("mainWindow focus event")}),mainWindow.on("show",function(){b.log("mainWindow show event")}),mainWindow.on("blur",function(){b.log("mainWindow focus event")}),Util.isMac){var a,c=require("electron").ipcMain,f=require("./RecorderFocusManager"),h=new f;c.on("updateRecorderFocusManager",function(c,d){b.log("got updateRecorderFocusManager message from renderer process");try{a=h.update(d.browserTitle,d.browserName),a.on("message",function(a){b.log("recorderFocusManager msg: "+a)}),a.stdout.on("data",function(a){b.log("recorderFocusManager stdout: "+a)}),a.stderr.on("data",function(a){b.log("recorderFocusManager stderr: "+a)})}catch(e){b.log("recorderFocusManager threw error: "+e)}c.returnValue=!0}),b.log("after registering ipcMain.on startTopper")}Util.isLinux&&mainWindow.setAlwaysOnTop(!0)};h.isReady()?i():(h.disableHardwareAcceleration(),h.on("ready",i))}},{key:"log",value:function(a){this.send({type:"log",msg:a})}},{key:"terminate",value:function(){(0,_get3["default"])(b.prototype.__proto__||(0,_getPrototypeOf2["default"])(b.prototype),"terminate",this).call(this),this._app.quit(),this.send("sandboxTerminated")}}]),b}(SandboxProcess);module.exports=ElectronSandboxProcess;