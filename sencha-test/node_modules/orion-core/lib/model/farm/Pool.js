"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_get2=require("babel-runtime/helpers/get"),_get3=_interopRequireDefault(_get2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Entity=require("orion-core/lib/model/Entity"),Browser=require("orion-core/lib/model/browser/Browser"),Json=require("orion-core/lib/Json"),Pool=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"ctor",value:function(){this.id=b.nextId(),this.browsers=[]}},{key:"add",value:function(a){a.isBrowser||(a=new Browser(a)),this.browsers.push(a),a.pool=this}},{key:"getBrowsers",value:function(){return _promise2["default"].resolve(this.browsers)}},{key:"getPersistData",value:function(){var a=[];return this.browsers.forEach(function(b){b.canPersist()&&a.push(b.data)}),a}},{key:"loadConfigFile",value:function(){var a=this,b=a.farm.workspace.resolve(a.data.path),c=a.farm.browserClass;return Json.read(b).then(function(d){return d&&(a.setSourceFile(b),d.forEach(function(b){var d=b.sencha||(b.sencha={});d.concurrency=d.concurrency||b.chunks||1,delete b.chunks,a.add(new c(b))})),a},function(b){return a})}},{key:"remove",value:function(a){var b=this.browsers,c=a;return"number"==typeof a?a=b[c]:c=b.indexOf(a),c>=0&&(c<b.length-1?b.splice(c,1):b.pop(),a.pool=null),a}},{key:"save",value:function(){var a=this;return a.sourceFile||a.setSourceFile(a.farm.workspace.resolve(a.data.path)),(0,_get3["default"])(b.prototype.__proto__||(0,_getPrototypeOf2["default"])(b.prototype),"save",this).call(this)}},{key:"sync",value:function(a){for(var b=this,c=b.browsers.length;c-- >0;)b.remove(b.browsers[c]);a.forEach(b.add,b)}},{key:"name",get:function(){return this.data.name}},{key:"browserClass",get:function(){return this.farm.browserClass}}]),b}(Entity);module.exports=Pool;