"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),SandboxRecorderAgent=require("orion-core/lib/model/test/SandboxRecorderAgent.js"),SandboxRunner=require("./SandboxRunner"),EventRecorderReporter=require("./EventRecorderReporter"),SandboxRecorderRunner=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"ctor",value:function(){var a,b,c,d=this;d.isRecording=!0,d.terminateAgents=!0,d.reporter=new EventRecorderReporter({runner:d}),a=d._getAgentGroup({id:d._generateAgentGroupId(),browser:d.browser||null}),c=d.agent=d._getAgent({id:d._generateAgentId(),terminateOnFinish:d.terminateAgents,isRecording:!0}),a.add(c),b={orionAgentId:c.id,orionRecording:d.isRecording},d.proxy.on({scope:d,single:!0,started:function(a){c&&(c.url=d.getAgentContactUrl(b),c.launch())}})}},{key:"_createAgent",value:function(a){var b=this,c=b.agents[a.id]=new SandboxRecorderAgent(a);return c}},{key:"cleanupAgents",value:function(){var a=this;a.agent.terminate()}},{key:"destroy",value:function(){this.destroyed=!0,this._messageQueue.length=0,this.cleanupAgents()}},{key:"recordingStopped",value:function(){this.proxy.stop()}}],[{key:"meta",get:function(){return{prototype:{sandboxPage:"~orion/sandbox/recorder.html"}}}}]),b}(SandboxRunner);module.exports=SandboxRecorderRunner;