"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Base=require("orion-core/lib/Base"),ChildProcessTask=require("orion-core/lib/tasks/ChildProcessTask"),Util=require("orion-core/lib/Util"),xfs=require("orion-core/lib/xfs"),ProcessUtil=require("orion-core/lib/process/ProcessUtil"),path=require("path"),SelfSpawner=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"ctor",value:function(){var a,b,c=this,d=(path.join(__dirname,".."),process.execPath),e=!1,f=[];if(d.endsWith("Sencha Studio.exe")||d.endsWith("Sencha Studio Helper")||d.endsWith("Launcher")?(a=!1,b=!0,e=!0):d.endsWith("electron.exe")||d.endsWith("Electron Helper")||d.endsWith("electron")?(a=!1,b=!1):d.endsWith("node.exe")||d.endsWith("node")||d.endsWith("nodejs")?(a=!0,b=null):(a=!1,b=!0),a){var g=path.join(process.mainModule.filename,".."),h=path.join(g,"..");Util.isMac?xfs.existsSync(path.join(g,"Electron.app"))?(d=path.join(g,"Electron.app","Contents","MacOS","Electron"),b=!0):xfs.existsSync(path.join(h,"Sencha Studio.app"))&&(d=path.join(h,"Sencha Studio.app","Contents","MacOS","Sencha Studio"),b=!0,e=!0):Util.isWin?xfs.existsSync(path.join(g,"electron.exe"))?(d=path.join(g,"electron.exe"),b=!0):xfs.existsSync(path.join(h,"Sencha Studio.exe"))&&(d=path.join(h,"Sencha Studio.exe"),b=!0,e=!0):Util.isLinux&&(xfs.existsSync(path.join(g,"electron"))?(d=path.join(g,"electron"),b=!0):xfs.existsSync(path.join(h,"Launcher"))&&(d=path.join(h,"Launcher"),b=!0,e=!0)),b||(d=require("electron"))}if(!a&&Util.isMac)if(b){var i="/Frameworks/Sencha Studio Helper.app/Contents/MacOS/Sencha Studio Helper",j="/MacOS/Sencha Studio";d=d.replace(i,j)}else{var k="/Frameworks/Electron Helper.app/Contents/MacOS/Electron Helper",l="/MacOS/Electron";d=d.replace(k,l)}if(Util.isWin&&(d=xfs.normalize(d)),!e){var m=void 0;m=a?path.join(process.mainModule.filename):path.join(process.mainModule.filename,"..","studio.js"),Util.isWin&&(m=xfs.normalize(m)),f.push(m)}f=f.concat(c.getSpawnSwitches()),c._execPath=d,c._params=f}},{key:"getExecPath",value:function(){return this._execPath}},{key:"spawn",value:function(){var a,b=this,c=b._execPath,d=Util.clone(b._params),e={stdio:Util.isLinux?["pipe","pipe","pipe","ipc"]:["ipc","pipe","pipe"]},f={description:b.getChildProcessDescription(),executable:c,args:d,stdoutLevel:"debug",opts:e};return Util.isWin&&(f.launchProcess=function(){return ProcessUtil.spawn({executable:c,args:d,options:e})}),a=b.task=new ChildProcessTask(f),a.running?b.onTaskRunning():a.on("running",b.onTaskRunning.bind(b)),a.on("complete",b.onTaskComplete.bind(b)),a}}],[{key:"meta",get:function(){return{mixinId:"selfSpawner"}}}]),b}(Base);module.exports=SelfSpawner;