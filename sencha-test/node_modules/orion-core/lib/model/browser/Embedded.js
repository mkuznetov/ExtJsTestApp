"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),LocalBrowser=require("orion-core/lib/model/browser/Local"),SelfSpawner=require("orion-core/lib/process/SelfSpawner"),console=require("orion-core/lib/util/console-manager").console,allowedMessages={windowCreated:1,windowLoaded:1,windowClosed:1},Embedded=function(a){function b(a){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).call(this,(0,_assign2["default"])({description:"Chromium (embedded)",version:process.versions.chrome,profile:"",type:"chromium",name:"Chrome",detected:!0},a)))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,null,[{key:"meta",get:function(){return{mixins:[SelfSpawner],prototype:{isEmbeddedBrowser:!0}}}}]),(0,_createClass3["default"])(b,[{key:"ctor",value:function(){this.set("command",this.execPath)}},{key:"launch",value:function(a){var b=this;return"string"==typeof a&&(a={url:a}),b._url=a.url,b.mixins.selfSpawner.spawn.call(b)}},{key:"getSpawnSwitches",value:function(){return["--embedded"]}},{key:"getChildProcessDescription",value:function(){return"Chromium"}},{key:"onTaskRunning",value:function(){var a=this,b=a.task.proc;b.on("message",function(b){var c=b.type||b;allowedMessages[c]&&(a.fire(c,b),a[c]&&a[c](b))}),b.send({type:"run",url:a._url,proxyPort:a.get("proxyPort")})}},{key:"onTaskComplete",value:function(){var a=this;a._running=!1,a.fire({type:"terminated",browser:a})}},{key:"screenshot",value:function(a){var b=this;return new _promise2["default"](function(a,c){b._screenshotResolve=a,b.task.proc.send({type:"screenshot"})})}},{key:"terminate",value:function(){var a=this;a.task.stop(),a.fire({type:"terminated",browser:a})}},{key:"canPersist",value:function(){return!this.data.detected}},{key:"isRunning",get:function(){return this._running}},{key:"execPath",get:function(){var a=this;return a.mixins.selfSpawner.getExecPath.call(a)}}]),b}(LocalBrowser);module.exports=Embedded;