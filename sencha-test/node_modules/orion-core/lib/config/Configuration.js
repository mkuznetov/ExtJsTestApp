"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),Json=require("../Json"),fs=require("fs"),xfs=require("../xfs"),Configuration=function(){function a(){(0,_classCallCheck3["default"])(this,a),this._data={},this._parent=null}return(0,_createClass3["default"])(a,[{key:"get",value:function(a){var b,c,d=this,e=d._data,f=d._parent;if("string"==typeof a)e.hasOwnProperty(a)?c=e[a]:f&&(c=f.get(a));else if(a)if(Array.isArray(a))c=[],a.forEach(function(a){c.push(d.get(a))});else{c={};for(b in a)c[b]=d.get(b)}return c}},{key:"set",value:function(a,b){var c=this.get(a),d=this._data;return"string"==typeof a?void 0===b?delete d[a]:d[a]=b:(0,_assign2["default"])(d,a),c}},{key:"load",value:function(a){var b=this;return a.endsWith(".json")?Json.read(a).then(function(a){return b.set(a),b}):new _promise2["default"](function(c,d){fs.readFile(a,"utf8",function(e,f){if(e)d(xfs.wrapError(a,e));else try{b.parseProperties(f),c(b)}catch(g){d(xfs.wrapError(a,g))}})})}},{key:"loadSync",value:function(a){try{var b;return a.endsWith(".json")?(b=Json.readFileSync(a),this.set(b)):(b=fs.readFileSync(a,"utf8"),this.parseProperties(b)),!0}catch(c){return!1}}},{key:"parseProperties",value:function(a){var b,c,d,e;for(a=a.split("\n"),b=0;b<a.length;++b)d=a[b].trim(),d&&!d.startsWith("#")&&(e=d.indexOf("="),e>0&&(c=d.substring(0,e).trim(),this._data[c]=d.substring(e+1)))}},{key:"parent",get:function(){return this._parent},set:function(a){this._parent=a}}]),a}();Configuration.prototype.isConfiguration=!0,module.exports=Configuration;