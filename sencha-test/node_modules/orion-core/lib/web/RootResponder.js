"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Responder=require("./Responder"),urlParse=require("url").parse,Interceptor=require("./Interceptor"),finalhandler=require("finalhandler"),path=require("path"),serveStatic=require("serve-static"),RootResponder=function(a){function b(a){(0,_classCallCheck3["default"])(this,b);var c,d=a.scenario,e=d.project,f=serveStatic(path.normalize(__dirname+"/../../serve/")),g=serveStatic(path.normalize(__dirname+"/../../sandbox/")),h=serveStatic(path.normalize(__dirname+"/../../node_modules/jasmine-core/lib/jasmine-core/")),i=serveStatic(e.getWorkspaceMountDir()),j=(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).call(this,{server:a,scenario:d,project:e,readRequestBody:!1,intercepts:[],serveLib:f,workspaceServeLib:i,routes:{"~orion":{routes:{files:{get:function(a){a.done=!0;var b=a.request,e=a.response,g="~orion/files/";b.url=b.url.substr(g.length),0==b.url.indexOf("/jasmine/jasmine.js")?(b.url="jasmine.js",h(b,e,finalhandler(b,e))):(d.get("orionCoverage")&&c.getInterceptor(a.url.path,e),f(b,e,finalhandler(b,e)))}},sandbox:{get:function(a){a.done=!0;var b=a.request,d=a.response,e="~orion/sandbox/";b.url=b.url.substr(e.length),c.getInterceptor(a.url.path,d),g(b,d,finalhandler(b,d))}},workspace:{get:function(a){a.done=!0;var b=a.request,c=a.response,d="~orion/workspace/";b.url=b.url.substr(d.length),i(b,c,finalhandler(b,c))}}}}}}));return c=j,j}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"getInterceptor",value:function(a,b){for(var c=urlParse(a),d=this.intercepts,e=null,f=0;f<d.length;f++){var g=d[f],h=g.test;if(h||(h=new RegExp(g.pattern),g.test=h),h.test(c.pathname)){e=new Interceptor({target:b,prepareData:g.fn,context:b.responderContext});break}}return e}},{key:"intercept",value:function(a,b){this.intercepts.push({pattern:a,fn:b})}},{key:"clearInterceptors",value:function(){this.intercepts.length=0}}]),b}(Responder);module.exports=RootResponder;