"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),File=require("orion-core/lib/fs/File"),WorkspaceScanner=function(){function a(){(0,_classCallCheck3["default"])(this,a)}return(0,_createClass3["default"])(a,[{key:"scan",value:function(a){var b=this,c=new File(a);return new _promise2["default"](function(a,d){c.getFiles().then(function(e){c.items=e,b._detectSenchaCfg(c,c).then(function(b){a(b)},d)},d)})}},{key:"_detectSenchaCfg",value:function(b,c,d){d=d||{packages:{dir:"${workspace.dir}/packages/local,${workspace.dir}/packages",extract:"${workspace.dir}/packages/remote"},frameworks:{}};var e=this,f=[],g=c.join(a.appCfgName),h=(c.join(a.packageCfgName),c.join(a.frameworkCfgName));return new _promise2["default"](function(a,i){g.existsSync()?c!=b&&(d.apps=d.apps||[],d.apps.push(b.relativeTo(c))):h.existsSync()&&(d.frameworks[c.name]=b.relativeTo(c).getPath()),c.items&&c.items.length&&c.items.forEach(function(a){a.stat.isDirectory()&&f.push(e._detectSenchaCfg(b,a,d))}),_promise2["default"].all(f).then(function(){a(d)},i)})}}],[{key:"appCfgName",get:function(){return".sencha/app/sencha.cfg"}},{key:"packageCfgName",get:function(){return".sencha/package/sencha.cfg"}},{key:"frameworkCfgName",get:function(){return"cmd/sencha.cfg"}}]),a}();module.exports=WorkspaceScanner;