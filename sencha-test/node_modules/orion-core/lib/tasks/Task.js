"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Observable=require("../Observable"),Manager=require("./Manager"),uuid=require("uuid"),Task=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"ctor",value:function(){this.id=this.id||uuid.v1(),Manager.addTask(this)}},{key:"_set",value:function(a,b){var c=this,d=c[a];d!=b&&(c.record&&(c.record.set(a,b),c.record.commit()),c[a]=b,c.fire({type:"change",property:a,old:d,value:b}),"complete"===a&&1==b&&c.fire("complete"))}},{key:"setDescription",value:function(a){this._set("description",a)}},{key:"done",value:function(){var a=this;a._set("stopped",!0),a._set("running",!1),a._set("complete",!0)}},{key:"stop",value:function(){this.done()}},{key:"getRecordData",value:function(){var a=this;return{id:a.id,internal:a.internal,description:a.description,running:a.running}}},{key:"setInternal",value:function(a){this._set("internal",a)}},{key:"_log",value:function(a,b){var c=this;return"string"==typeof a?a={message:a,level:b||"info",time:(new Date).getTime(),description:c.description}:a.level=b||a.level,c.htmlFormatMessages&&(a.message=(a.rawMessage=a.message).replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\n/g,"<br>")),this.fire({type:"logMessage",message:a}),a}},{key:"warn",value:function(a){this._log(a,"warn")}},{key:"info",value:function(a){this._log(a,"info")}},{key:"error",value:function(a){this._log(a,"error")}},{key:"debug",value:function(a){this._log(a,"debug")}}],[{key:"meta",get:function(){return{prototype:{internal:!1,htmlFormatMessages:!1}}}}]),b}(Observable);Task.prototype.isTask=!0,module.exports=Task;