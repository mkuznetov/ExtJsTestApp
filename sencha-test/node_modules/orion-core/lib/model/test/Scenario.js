"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Entity=require("../Entity"),Path=require("path"),xfs=require("../../xfs"),Url=require("url"),urlParse=Url.parse,TargetUrl=require("../TargetUrl"),Scenario=function(a){function b(a,c){(0,_classCallCheck3["default"])(this,b);var d,e=(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).call(this,a)),f=e,a=f.data,g=a.libs||(a.libs=[]),h=(a.coverageFilters||(a.coverageFilters=[]),g.length);for(f.project=c,f.name=a.name;h-- >0;)d=g[h],"string"==typeof d&&(g[h]={path:d});return e}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,null,[{key:"meta",get:function(){return{mixins:[TargetUrl]}}}]),(0,_createClass3["default"])(b,[{key:"getGlobals",value:function(){var a,b=this.project.get("globals")||"",c=this.get("globals")||"";for(b=b.trim()+"\n"+c.trim(),b=b.split("\n"),a=b.length;a-- >0;)(b[a]=b[a].trim())||b.splice(a,1);return b}},{key:"getTestFramework",value:function(){var a=this.get("framework"),b=this.project;return!a&&b&&(a=b.getTestFramework()),a||null}},{key:"getTestPath",value:function(){return Path.join(this.project.dir,this.data.directory)}},{key:"getFiles",value:function(){var a,b,c=this,d=c.getTestPath(),e=c.files;return a=xfs.listAllFilesSync(d),e=c.files=[],b=function(a,c){a.stat.isDirectory()?a.items.forEach(function(a){b(a,c)}):a.path.endsWith(".js")&&c.push(a.path)},a.forEach(function(a){b(a,e)}),e}},{key:"getLibs",value:function(a){var b=this,c=[],d=[],e=b.project.data.libs,f=b.data.libs,g="http://foo.com"+b.project.getWorkspaceRelativePath();return e&&e.length&&c.push.apply(c,e),f&&f.length&&c.push.apply(c,f),c.forEach(function(b){var c,e=b;b&&("string"==typeof b||!b.disabled&&(e=b.path))&&(e.indexOf("://")<0&&(c=Url.resolve(g,e),c=Url.parse(c),e=(a||"")+c.pathname),d.push(e))}),d}},{key:"getTargetUrl",value:function(){var a=this,b=a.get("page"),c=a.project,d=urlParse(b||"");return d.hostname?b:[c.getTargetUrl(a.get("profile"),a),b].filter(function(a){return!!a}).join("")}},{key:"dir",get:function(){return this.project.resolve(this.data.directory)}}]),b}(Entity);module.exports=Scenario;