console.log('sandbox.js loaded');

preventNavigation = function (e) {
    if (ST.defaultContext.driver) {
        ST.defaultContext.driver.url()
            .then(function () {
                // The target browser is still running. Prevent navigation/reloading of the Sandbox,
                // but make sure the target gets ST reloaded.
                e.returnValue = '';
                if (ST.defaultContext.isRecording) {
                    ST.defaultContext.initScrollSurface();
                    ST.defaultContext._loadST();
                }
                e.preventDefault();
            }, function (err) {
                console.log('err', err);
                if (err.seleniumStack.status == 13 || err.seleniumStack.status == 23 || err.type === 'NoSessionIdError') {
                    // The browser window was closed from under us, close accordingly
                    window.removeEventListener('onbeforeunload', preventNavigation);
                    if (ST.defaultContext.isRecording) {
                        ST.defaultContext.stopRecording();
                    }
                }
            });
    }
};
window.addEventListener('onbeforeunload', preventNavigation);
