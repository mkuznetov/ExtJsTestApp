"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),GenericBrowser=require("orion-core/lib/model/browser/Generic"),BrowserPool=require("orion-core/lib/model/farm/Pool"),Entity=require("orion-core/lib/model/Entity"),Observable=require("orion-core/lib/Observable"),webdriverio=require("webdriverio"),Farm=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"ctor",value:function(){var a=this.data;a.port=a.port||4444}},{key:"ctor",value:function(){var a=this,b=(a.pools=[],a.data),c=b.pools;a.agentQueue=[],a.sessionCount=0,c&&(delete b.pools,Array.isArray(c)?c.forEach(function(b){a.add(new BrowserPool(b))}):a.error=new Error('The "pools" property must be an array for browser farm "'+b.name+'"'))}},{key:"remoteDriver",value:function(a){var b=this.driverConfig(a);return webdriverio.remote(b)}},{key:"driverConfig",value:function(a){var b={host:this.hostName,port:this.port,desiredCapabilities:(0,_assign2["default"])({},a)};return b}},{key:"add",value:function(a){if(a.farm){if(a.farm===this)return;a.farm.remove(a)}this.pools.push(a),a.farm=this}},{key:"eachPool",value:function(a,b){this.pools.forEach(a,b)}},{key:"getBrowsers",value:function(){function a(a,b,c){var d,e=[];for(d=b;d<=c;++d)e.push((0,_assign2["default"])({long_version:d+".0",short_version:d},a));return e}return _promise2["default"].resolve([].concat(a({api_name:"internet explorer",long_name:"Internet Explorer",os:"Windows 7"},8,11),a({api_name:"firefox",long_name:"Firefox",os:"Windows 7"},38,42),a({api_name:"chrome",long_name:"Google Chrome",os:"Windows 7"},42,46),a({api_name:"safari",long_name:"Safari",os:"Mac 10.9"},6,9)))}},{key:"getPool",value:function(a){var b,c,d=this.pools;for(a=a.toLowerCase(),c=0;c<d.length;++c)if(a===(b=d[c]).getName().toLowerCase())return b;return null}},{key:"getPools",value:function(a){for(var b=this.pools,c=[],d=0;d<b.length;d++){var e=b[d];a&&e.name.toLowerCase().indexOf(a.toLowerCase())>=0&&c.push(e)}return c}},{key:"remove",value:function(a){var b=this.pools,c=a;return"number"==typeof a?a=b[c]:c=b.indexOf(a),c>=0&&(b.splice(c,1),a.farm=a.workspace=null),a}},{key:"start",value:function(){return _promise2["default"].resolve()}},{key:"stop",value:function(){return _promise2["default"].resolve()}},{key:"onTaskStart",value:function(a){var b=this;b.isTaskRunning=!0,b.fire("taskstarted",b),a.on({scope:b,single:!0,running:function(){b.isConnectionRunning=!0,b.fire("connectionstarted",b)}})}},{key:"onTaskStop",value:function(){this.isTaskRunning=!1,this.isConnectionRunning=!1,this.fire("connectionstopped",this),this.fire("taskstopped",this)}},{key:"connectionDisplay",get:function(){return"Generic Selenium Farm"}},{key:"displayInfo",get:function(){return{displayName:"Generic Selenium",iconClass:"selenium"}}},{key:"browserClass",get:function(){return GenericBrowser}},{key:"hostName",get:function(){return this.host}},{key:"username",get:function(){return this.data.username},set:function(a){this.data.username=a}},{key:"accessKey",get:function(){return this.data.accessKey},set:function(a){this.data.accessKey=a}},{key:"host",get:function(){return this.data.host}},{key:"port",get:function(){return this.data.port}},{key:"sessionCount",get:function(){return this._sessionCount},set:function(a){this._sessionCount=a}},{key:"sessionLimit",get:function(){return this.data.sessionLimit}},{key:"autoStartTunnel",get:function(){return this.data.autoStartTunnel}},{key:"autoStartTunel",set:function(a){this.data.autoStartTunnel=a}},{key:"displayType",get:function(){return"Generic"}}],[{key:"meta",get:function(){return{mixins:[Observable]}}}]),b}(Entity);module.exports=Farm;