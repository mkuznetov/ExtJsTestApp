"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _stringify=require("babel-runtime/core-js/json/stringify"),_stringify2=_interopRequireDefault(_stringify),_promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),fs=require("fs"),xfs=require("./xfs"),JSON5=require("json5"),objectExtractRe=/^[^{]*({[\s\S]*})[^}]*$/m,arrayExtractRe=/^[^[]*(\[[\s\S]*\])[^\]]*$/m,Json={parse:function(a){return JSON5.parse(a)},parseFrom:function(a){var b,c=a.indexOf("{"),d=a.indexOf("["),e=arrayExtractRe,f=objectExtractRe;if(c>=0&&(d<0||c<d)&&(e=objectExtractRe,f=arrayExtractRe),(b=e.exec(a))||(b=f.exec(a)),!b)throw new Error("No data found");return JSON.parse(b[1])},read:function(a,b){return new _promise2["default"](function(c,d){fs.readFile(a,b||"utf8",function(b,e){if(b)d(xfs.wrapError(a,b));else try{c(Json.parse(e))}catch(f){d(xfs.wrapError(a,f))}})})},write:function(a,b){var c=(0,_stringify2["default"])(b,null,4);return xfs.writeFile(a,c)},readSync:function(a,b){try{var c=fs.readFileSync(a,b||"utf8");return Json.parse(c)}catch(d){throw xfs.wrapError(a,d)}},writeSync:function(a,b){var c=(0,_stringify2["default"])(b,null,4);fs.writeFileSync(a,c)}};module.exports=Json;